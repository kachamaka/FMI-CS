<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>Пример 1804: Линия и най-близка точка</title>

	<script src="suica.min.js"></script>

	<script>
		function main()
		{
			p = new Suica();
			orthographic(-1000,1000);
			lookAt([0,0,100],[0,0,0],[0,1,0]);
			
			p.gl.canvas.addEventListener('mousedown',mouseDown,false);
			p.gl.canvas.addEventListener('mouseup',mouseUp,false);
			p.gl.canvas.addEventListener('mousemove',mouseMove,false);
			
			A = [random(-300,-200),random(-150,150),0];
			B = [random( 200, 300),random(-150,150),0];
			l1 = line(A,B).custom({color:[0,0.5,1]});
			
			// сфера по линия l
			D = sphere([0,0,0],20);
			
			// свободно влачена сфера
			C = sphere([100,0,0],5).custom({interactive:true, color:[0,0.5,1]});
			
			l2 = segment(C.center,D.center).custom({color:[0,0.5,1]});

			p.nextFrame = animate;
			
		}

		var obj = null;

		function mouseDown(event)
		{
			x = event.clientX;
			y = event.clientY;
			obj = p.objectAtPoint(x,y);
		}
		
		function mouseUp(event)
		{
			obj = null;
		}

		function mouseMove(event)
		{
			if (obj)
			{
				C.center[0] += event.clientX-x;
				C.center[1] -= event.clientY-y;
			}
			x = event.clientX;
			y = event.clientY;
		}
		
		cos = Math.cos;
		sin = Math.sin;
		
		function animate()
		{
			t = Suica.time/2;
			
			// въртене на правата
			A = [cos(t),sin(1.3*t),0];
			B = [3*cos(1.2*t),3*sin(1.2*t),0];
			l1.from = A; l1.to = B;

			// изчисляване на k
			AB = vectorPoints(B,A);
			k =((C.center[0]-A[0])*AB[0]+(C.center[1]-A[1])*AB[1])/(AB[0]*AB[0]+AB[1]*AB[1]);

			// намиране на най-близката до C точка
			D.center[0] = A[0]+k*AB[0];
			D.center[1] = A[1]+k*AB[1];
		}
	</script>	
</head>

<body onload="main()">
	<noscript>
		Искаме JavaScript, но няма!
	</noscript>
	
	<canvas width="740" height="350" style="border: solid 1px Black;">
		Искаме canvas, но няма!
	</canvas>
</body>
