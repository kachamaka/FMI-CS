<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>Пример 1610: Градско бягане</title>

	<script src="suica.min.js"></script>

	<script>
		function main()
		{
			info = document.getElementById('info');
			
			new Suica().nextFrame = chase;
			background([0,0,0]);
			
			// сгради
			for (var x=-12; x<11; x+=2)
			for (var y=-12; y<11; y+=2)
			{
				var c = random(0.5,1);
				cuboid([x+1,y+1,0],[0.8,0.8,random(0.4,2)]).custom({
					origin: [0,0,-0.5],
					color: [0,c/2,c]
				});
			}
		}		
		
		dir = 0;
		dir2 = 0;
		pos = [0,0,0.5];
		pos2 = pos;
		target = [0,0,0];
		up = [0,0,1];
		
		frame=-1;
		k=50;
		function chase()
		{
			frame++;
			
			pos[0] += 2/k*Math.cos(dir);
			pos[1] += 2/k*Math.sin(dir);
			
			if (Math.abs(pos[0])>10 ||
				Math.abs(pos[1])>10 )
			{
				pos[0] = Math.max(pos[0],-10);
				pos[0] = Math.min(pos[0],+10);
				pos[1] = Math.max(pos[1],-10);
				pos[1] = Math.min(pos[1],+10);
				frame = 0;
			}
			
			if (frame%k==0)
			{
				dir += Math.PI/2*(Math.round(random(-0.7,0.7)));
				pos[0] = Math.round(pos[0]);
				pos[1] = Math.round(pos[1]);
			}

			for (var i=0; i<3; i++)
				pos2[i] = pos2[i]*0.95+0.05*pos[i];
			dir2 = dir2*0.95+0.05*dir;
			target2 = [pos2[0]+Math.cos(dir2),pos2[1]+Math.sin(dir2),0.5];

			lookAt(pos2,target2,up);
		}
	</script>	
</head>

<body onload="main()">
	<noscript>
		Искаме JavaScript, но няма!
	</noscript>
	
	<canvas width="740" height="350" style="border: solid 1px Black;">
		Искаме canvas, но няма!
	</canvas>
</body>
