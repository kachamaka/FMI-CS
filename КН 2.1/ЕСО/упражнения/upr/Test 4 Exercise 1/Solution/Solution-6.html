<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>T4-00</title>

	<script src="suica.min.js"></script>

	<script>
	
		// Подзадача 6:
		// Добавете бутон [Скок], с който слончето се издига
		// нагоре, прави три стъпки напред и слиза надолу


		
		function main()
		{
			new Suica().nextFrame = animate;
			lookAt([18,8,5],[0,0,0],[0,0,1]);

			// земя
			for (var x=-5; x<=5; x++)
			for (var y=-5; y<=5; y++)
				cube([x,y,-1],0.9).custom({color:[1,0.8,0.5]});

			// слонче
			slonche = group([
				cube([0,0,0],1).custom({color:[0.8,0.8,0.8]}),
				cube([0,0,1.3],1.8).custom({color:[0.8,0.8,0.8]}),
				cuboid([-1.1,0,0.5],[0.2,0.2,1]).custom({color:[0.8,0.8,0.8]}),
				cylinder([0.8,0.25,1.5],0.2,0.2).custom({color:[1,1,1],focus:[1,0,0]}),
				cylinder([0.8,-0.25,1.5],0.2,0.2).custom({color:[1,1,1],focus:[1,0,0]}),
				sphere([0.9,0.25,1.5],0.15).custom({color:[0,0,0]}),
				sphere([0.9,-0.25,1.5],0.15).custom({color:[0,0,0]}),
				cuboid([0.4,1.7,1.3],[0.2,1.4,1.4]).custom({color:[0.8,0.8,0.8]}),
				cuboid([0.4,-1.7,1.3],[0.2,1.4,1.4]).custom({color:[0.8,0.8,0.8]}),
				cuboid([0.45,1.7,1.3],[0.2,1.1,1.1]).custom({color:[0.9,0.9,0.9]}),
				cuboid([0.45,-1.7,1.3],[0.2,1.1,1.1]).custom({color:[0.9,0.9,0.9]}),
				cone([0.8,0.45,0.9],0.1,1).custom({color:[0.9,0.9,0.9],light:false,focus:[3,0,-1]}),
				cone([0.8,-0.45,0.9],0.1,1).custom({color:[0.9,0.9,0.9],light:false,focus:[3,0,-1]}),
			]);
			slonche.spin = 0;
					
			// цветенце
			cvetence = group([
				segment([0,0,0],[0,0,1]).custom({color:[0,1,0]}),
				cube([0,0,1],0.2).custom({color:[1,1,0],light:false}),
				cuboid([0,0,0.95],[0.2,0.6,0.2]).custom({color:[1,0,0]}),
				cuboid([0,0,0.95],[0.6,0.2,0.2]).custom({color:[1,0,0]}),
				cuboid([0,-0.14,0.4],[0.4,0.2,0.02]).custom({color:[0,1,0],focus:[0,1,1]}),
				cuboid([0,0.14,0.4],[0.4,0.2,0.02]).custom({color:[0,1,0],focus:[0,-1,1]}),
			]);
			cvetence.center = [2,0,-0.5];

			// хоботът
			hobot = group([
				cuboid([0,0,0],[1.4,0.3,0.3]).custom({
					color:[0.8,0.8,0.8],
					origin:[-0.5,0,0]}),
			]);
			hobot.center = [1.1,0,1];
			hobot.focus = [0,1,0];
			slonche.add(hobot);
			
			// връх на хобота
			hobot_vruh = group([
				cuboid([0,0,0],[0.4,0.3,0.3]).custom({color:[0.8,0.8,0.8]}),
			]);
			hobot_vruh.center = [1.25,0,0];
			hobot_vruh.origin = [-0.4,0,0];
			hobot.add(hobot_vruh);

			// флаг за движение на хобота
			dvizenie = false;
	
			// НОВО
			// скачане на слончето е на 5 фази: стъпка нагоре, после
			// стъпка напред, пак напред, пак напред и накрая стъпка
			// надолу, като фазите ще сменяме през 15 кадъра
			faza_na_skok = 0; // фаза на скачането (1..5)
			kadur = 0; // брояч на кадрите
		}

		
		function animate()
		{
			if (dvizenie)
			{
				// хоботът се движи
				hobot.spin = radians(90*(1+Math.sin(Suica.time)));
				hobot_vruh.spin = -radians(90*Math.sin(Suica.time));
			}
			else
			{
				// хоботът не се движи
				hobot.spin = radians(0);
				hobot_vruh.spin = radians(90);
			}
			
			
			// НОВО
			// на всеки 15 кадъра проверяваме дали слончето е в някоя фаза на скачане
			kadur++;
			if( kadur%15 == 0 )
			{
				// НОВО
				// слончето е в скок само ако фазата е 1, 2, 3, 4 или 5
				switch (faza_na_skok)
				{
					case 5: slonche.center[2]++; break; // стъпка нагоре
					case 4: button_napred(); break; // стъпка напред
					case 3: button_napred(); break; // стъпка напред
					case 2: button_napred(); break; // стъпка напред
					case 1: slonche.center[2]--; break; // стъпка надолу
				}
				
				// НОВО
				// след тази стъпка преминаваме в следваща фаза
				faza_na_skok--;
			}
		}
		
		
		// бутон [Хобот]
		function button_hobot()
		{
			dvizenie = !dvizenie;
		}

		
		// бутон [Напред]
		function button_napred()
		{
			slonche.center[0] += Math.cos(slonche.spin);
			slonche.center[1] -= Math.sin(slonche.spin);
		}

		
		// бутон [Настрани]
		function button_nastrani()
		{
			var ugul = Math.random()>0.5 ? 90 : -90;
			slonche.spin += radians(ugul);
			button_napred();
		}

	</script>	
</head>

<body onload="main()">
	<canvas width="598" height="398" style="border: solid 1px Black;"></canvas>
	<div style="position:relative; top:-396px; left:0.5em;">
		<button onclick="button_hobot()">Хобот</button>
		<button onclick="button_napred()">Напред</button>
		<button onclick="button_nastrani()">Настрани</button>
		<button onclick="faza_na_skok = 5">Скок</button> <!-- НОВО. Слагаме слончето във фаза 5 на скока -->
	</div>
</body>
